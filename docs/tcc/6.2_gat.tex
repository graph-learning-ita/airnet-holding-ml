\section[Graph Attention Network]{Graph Attention Network}
\label{Graph Attention Network}

As we previously described, the GAT model in \ref{spatial-based} has a large range of applications, from drug discovery to fake news detection \cite{keywordsCaravanti}. The GAT model leverages the underlying graph structure but does not rely on explicitly computed graph-derived features like the CatBoost model does. Instead, it learns node representations in an end-to-end manner, enabling the model to capture the relationships between airports and flights directly from the data.

\input{img/gat_layer.tex}

\begin{figure}[h]
  \centering
  \begin{tikzpicture}
      % Define colors for different attention heads
      \definecolor{color1}{RGB}{60, 120, 216}  % Blue for Head 1
      \definecolor{color2}{RGB}{34, 139, 34}   % Green for Head 2
      \definecolor{color3}{RGB}{255, 99, 71}   % Red for Head 3
      
      % Define nodes
      \node[circle, draw, thick] (node1) at (0,0) {$\vec{h}_1$};
      \node[circle, draw, thick] (node2) at (5,0) {$\vec{h}_2$};
      
      % Flight 1 - Blue attention heads, no intersections
      \draw[-stealth, thick, color1!50] (node1) .. controls +(1,2) and +(-1,2) .. node[midway, above, color1!50] {$\alpha_{1,2}^{(1)}$} (node2);
      \draw[-stealth, thick, color1!70] (node1) .. controls +(1,1.5) and +(-1,1.5) .. node[midway, above, color1!70] {$\alpha_{1,2}^{(2)}$} (node2);
      \draw[-stealth, thick, color1] (node1) .. controls +(1,1) and +(-1,1) .. node[midway, above, color1] {$\alpha_{1,2}^{(3)}$} (node2);
      
      % Flight 2 - Green attention heads, spaced below Flight 1
      \draw[-stealth, thick, color2!50] (node1) .. controls +(1,-1) and +(-1,-1) .. node[midway, below, color2!50] {$\alpha_{1,2}^{(1)}$} (node2);
      \draw[-stealth, thick, color2!70] (node1) .. controls +(1,-1.5) and +(-1,-1.5) .. node[midway, below, color2!70] {$\alpha_{1,2}^{(2)}$} (node2);
      \draw[-stealth, thick, color2] (node1) .. controls +(1,-2) and +(-1,-2) .. node[midway, below, color2] {$\alpha_{1,2}^{(3)}$} (node2);

      % Flight 3 - Red attention heads, even lower to avoid overlap
      \draw[-stealth, thick, color3!50] (node1) .. controls +(1,-3) and +(-1,-3) .. node[midway, below, color3!50] {$\alpha_{1,2}^{(1)}$} (node2);
      \draw[-stealth, thick, color3!70] (node1) .. controls +(1,-3.5) and +(-1,-3.5) .. node[midway, below, color3!70] {$\alpha_{1,2}^{(2)}$} (node2);
      \draw[-stealth, thick, color3] (node1) .. controls +(1,-4) and +(-1,-4) .. node[midway, below, color3] {$\alpha_{1,2}^{(3)}$} (node2);

      % Output node
      \node[circle, draw, thick, right=7em of node2, opacity=0.8] (output) {$\vec{h}_2'$};
      
      % Aggregation line with label
      \draw[-stealth, thick, color1!70] (node2) -- ++(1.5,0) -- ++(1.5,0) node[midway, above, black] {concat/avg} -- (output);
  \end{tikzpicture}
  \caption{GAT Layer with multi-head attention for three different flights between nodes.}
  \label{fig:gat_layer}
\end{figure}
